<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECCジュニア 授業料シミュレーター</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <h1>ECCジュニア 授業料シミュレーター</h1>
                <button id="open-config-btn" class="icon-btn" title="教室情報設定">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
                        </path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    教室設定
                </button>
                <button id="open-pricing-btn" class="icon-btn" title="授業料設定" style="margin-left: 10px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    授業料設定
                </button>
                <button id="open-material-btn" class="icon-btn" title="教材費設定" style="margin-left: 10px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        <line x1="9" y1="7" x2="17" y2="7"></line>
                        <line x1="9" y1="11" x2="15" y2="11"></line>
                    </svg>
                    教材費設定
                </button>
            </div>
            <p>2025年度 学費案内に基づく授業料のシミュレーション</p>
        </header>

        <main class="main-content">
            <!-- Left Column: Settings -->
            <section class="config-panel">

                <!-- Step 1: 対象年齢 -->
                <div class="form-group">
                    <h2><span class="step-num">1</span> 対象年齢</h2>
                    <select id="age-selector" class="premium-select">
                        <!-- JS generated -->
                    </select>
                </div>

                <!-- Step 2: コース選択 -->
                <div class="form-group">
                    <h2><span class="step-num">2</span> コース選択</h2>
                    <p class="helper-text">受講するコースを選択してください（複数選択可）。オプションがあるコースは選択後に表示されます。</p>
                    <div class="course-list" id="course-list">
                        <!-- JS generated -->
                    </div>
                </div>

                <!-- Step 3: 入学金 -->
                <div class="form-group">
                    <h2><span class="step-num">3</span> 入学金</h2>
                    <div class="radio-group vertical">
                        <label class="radio-label">
                            <input type="radio" name="entrance-fee" value="full" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-text">
                                <span class="primary">通常入学（5,500円）</span>
                                <span class="secondary">入学金が発生します</span>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="entrance-fee" value="waived">
                            <span class="radio-custom"></span>
                            <div class="radio-text">
                                <span class="primary">入学金全額免除</span>
                                <span class="secondary">在籍生の家族（同居の2親等まで）が入学する場合</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Step 4: 教材費 -->
                <div class="form-group">
                    <h2><span class="step-num">4</span> 教材費</h2>
                    <p class="helper-text">品目ごとの価格が表示されます。兄弟のお下がりがある場合は「お下がり」にチェックを入れると差し引かれます。</p>
                    <div id="material-items-container">
                        <div style="text-align:center;color:#999;padding:20px;">コースを選択してください</div>
                    </div>
                </div>

                <!-- Step 5: スクールバック差引 -->
                <div class="form-group">
                    <h2><span class="step-num">5</span> スクールバック代金（差引）</h2>
                    <p class="helper-text">スクールバック代金を差し引く場合は金額を入力してください。初回納入金から差し引かれます。</p>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                            <input type="checkbox" id="bag-discount-toggle" checked>
                            <span>スクールバック差引を適用する</span>
                        </label>
                    </div>
                    <div id="bag-discount-input-area" style="margin-top:10px;">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <span style="color:#c8102e;font-weight:bold;">−</span>
                            <input type="number" id="bag-discount-amount" class="premium-input" value="1990" min="0"
                                style="width:120px;text-align:right;">
                            <span>円</span>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Right Column: Estimate Summary -->
            <section class="estimate-panel">
                <div class="sticky-card">
                    <h2>お見積り概算</h2>

                    <!-- Breakdown -->
                    <div id="breakdown-list" style="margin-bottom: 15px;">
                        <div style="opacity:0.6;font-size:0.85rem;">コースを選択してください</div>
                    </div>

                    <div class="total-section">
                        <div class="total-row section-label"><span>━━ 月額費用 ━━</span></div>
                        <div class="total-row grand-total">
                            <span>月々のお支払い</span>
                            <span id="monthly-total-display">0円</span>
                        </div>
                    </div>

                    <div class="initial-cost-section">
                        <h3>初回納入金</h3>
                        <div class="total-row">
                            <span>入学金</span>
                            <span id="entrance-display">5,500円</span>
                        </div>
                        <div class="total-row" id="exam-fee-row" style="display:none;">
                            <span>検定料</span>
                            <span id="exam-display">0円</span>
                        </div>
                        <div class="total-row">
                            <span>教材費</span>
                            <span id="material-display">0円</span>
                        </div>
                        <div class="total-row" id="onetime-row" style="display:none;">
                            <span>受講料（短期）</span>
                            <span id="onetime-display">0円</span>
                        </div>
                        <div class="total-row" id="bag-discount-row" style="display:none;">
                            <span>スクールバック差引</span>
                            <span id="bag-discount-display" style="color:#4ade80;">-0円</span>
                        </div>
                        <div class="total-row"
                            style="border-top:1px solid rgba(255,255,255,0.2);padding-top:8px;margin-top:8px;font-weight:bold;">
                            <span>初回納入金 合計</span>
                            <span id="initial-total-display">0円</span>
                        </div>
                    </div>

                    <div style="background:rgba(255,255,255,0.15);padding:12px;border-radius:8px;margin-bottom:15px;">
                        <div class="total-row grand-total" style="margin:0;">
                            <span>初回お振込総額</span>
                            <span id="grand-total-display">0円</span>
                        </div>
                        <p class="note">※月額 + 初回諸費用の合計です</p>
                    </div>

                    <div class="client-info-box">
                        <input type="text" id="student-name" placeholder="生徒氏名" class="premium-input compact"
                            style="margin-bottom:10px;">
                        <div style="display:flex;gap:10px;flex-wrap:wrap;">
                            <div style="flex:1;min-width:140px;">
                                <label
                                    style="font-size:0.78rem;color:rgba(255,255,255,0.8);display:block;margin-bottom:4px;">見積有効期限</label>
                                <input type="date" id="estimate-expiry" class="premium-input compact"
                                    style="color:var(--text-main);">
                            </div>
                            <div style="flex:1;min-width:140px;">
                                <label
                                    style="font-size:0.78rem;color:rgba(255,255,255,0.8);display:block;margin-bottom:4px;">お振込期限</label>
                                <input type="date" id="payment-deadline" class="premium-input compact"
                                    style="color:var(--text-main);">
                            </div>
                        </div>
                    </div>

                    <button class="action-btn" id="generate-btn">見積書兼請求書を作成する</button>
                </div>
            </section>
        </main>

        <!-- ===== Printable Estimate ===== -->
        <div id="printable-estimate" class="printable-sheet">
            <div class="sheet-header">
                <div class="header-left">
                    <div class="title-block">
                        <h1>授業料 御見積書兼請求書</h1>
                    </div>
                    <div class="meta-block">
                        <p>発行日: <span id="print-date"></span></p>
                        <p>No: <span id="estimate-id"></span></p>
                        <p id="print-expiry-line" style="display:none;">見積有効期限: <span id="print-expiry"></span></p>
                        <p id="print-deadline-line" style="display:none;">お振込期限: <span id="print-deadline"></span></p>
                    </div>
                </div>
                <div class="header-right" id="print-company-info-container">
                    <!-- Company Info -->
                </div>
            </div>

            <div class="recipient-section">
                <h2 id="print-student-name">______ 様</h2>
                <p>この度は、ECCジュニアへのお問い合わせ誠にありがとうございます。<br>
                    以下の通り、授業料のお見積もりを申し上げます。<br>
                    内容をご確認の上、ご検討いただきますようお願い申し上げます。</p>
            </div>

            <table class="estimate-table">
                <thead>
                    <tr>
                        <th>項目</th>
                        <th>内容</th>
                        <th>金額 (税込)</th>
                    </tr>
                </thead>
                <tbody id="print-table-body">
                    <!-- Dynamic Rows -->
                </tbody>
            </table>

            <div class="remarks-section">
                <h3>備考</h3>
                <ul>
                    <li>月謝は毎月最終授業日までにその翌月分を納入いただきます。</li>
                    <li>月半ば（11日〜20日）での入学の場合、月謝は半額となります（開講月4月を除く）。</li>
                    <li>在籍生のご家族（同居の2親等まで）が入学される場合は、入学金が全額免除されます。</li>
                    <li>一旦納入された入学金・授業料・教材費等は、返金できかねますのでご了承ください。</li>
                    <li>1年以内に教室で再受講希望の場合は、入学金を全額免除します。</li>
                </ul>
            </div>
        </div>

    </div>

    <!-- ===== Config Modal ===== -->
    <div id="config-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>教室情報設定</h2>
                <button id="close-config-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-desc">入力内容はブラウザに自動保存されます。</p>

                <div class="form-section">
                    <label>教室ロゴ</label>
                    <div class="logo-upload-area">
                        <img id="logo-preview" src="" alt="ロゴプレビュー" class="logo-preview hidden">
                        <div class="upload-controls">
                            <input type="file" id="logo-input" accept="image/*">
                            <button id="logo-clear-btn" class="secondary-btn small hidden"
                                style="width:auto;padding:5px 10px;color:#666;border-color:#ccc;">削除</button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <label>教室名</label>
                    <input type="text" id="cfg-company" class="premium-input" placeholder="例: ECCジュニア 〇〇教室">
                </div>

                <div class="form-section">
                    <label>郵便番号</label>
                    <input type="text" id="cfg-zip" class="premium-input" placeholder="例: 771-1252">
                </div>

                <div class="form-section">
                    <label>住所</label>
                    <textarea id="cfg-address" class="premium-input" rows="2"
                        placeholder="例: 徳島県板野郡藍住町矢上字北分82-1"></textarea>
                </div>

                <div class="form-section">
                    <label>電話番号</label>
                    <input type="text" id="cfg-phone" class="premium-input" placeholder="例: 088-692-5483">
                </div>

                <div class="form-section">
                    <label>登録番号 (インボイス)</label>
                    <input type="text" id="cfg-invoice" class="premium-input" placeholder="例: T1234567890123">
                </div>

                <div class="form-section">
                    <label>振込先口座情報</label>
                    <textarea id="cfg-bank" class="premium-input" rows="3"
                        placeholder="例: ゆうちょ銀行&#10;16210-153351&#10;名義）犬伏由美"></textarea>
                </div>

                <button id="save-config-btn" class="action-btn"
                    style="background:var(--primary);color:white;">保存して閉じる</button>
            </div>
        </div>
    </div>

    <!-- ===== Pricing Modal ===== -->
    <div id="pricing-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>授業料・諸費用設定（税込）</h2>
                <button id="close-pricing-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <p class="modal-desc">各コースの月謝・入学金・検定料・教材費を編集できます。変更はブラウザに保存され、次回以降も適用されます。</p>

                <div id="pricing-tables-container">
                    <!-- JS generated -->
                </div>

                <div
                    style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <button id="reset-pricing-btn" class="icon-btn"
                            style="color: #666; border-color: #ccc;">デフォルトに戻す</button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button id="set-default-btn" class="icon-btn"
                            style="color: var(--primary); border-color: var(--primary);">現在の設定をデフォルトにする</button>
                        <button id="save-pricing-btn" class="action-btn"
                            style="width: auto; padding: 10px 30px; margin: 0; background: var(--primary); color: white;">保存して閉じる</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="material-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>教材費設定（品目別）</h2>
                <button id="close-material-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <p class="modal-desc">各コースの教材品目・価格を一覧で確認・編集できます。品目の追加・削除も可能です。変更はブラウザに保存され、次回以降も適用されます。</p>

                <div id="material-tables-container">
                    <!-- JS generated -->
                </div>

                <div
                    style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <button id="reset-material-btn" class="icon-btn"
                            style="color: #666; border-color: #ccc;">デフォルトに戻す</button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button id="set-default-material-btn" class="icon-btn"
                            style="color: var(--primary); border-color: var(--primary);">現在の設定をデフォルトにする</button>
                        <button id="save-material-btn" class="action-btn"
                            style="width: auto; padding: 10px 30px; margin: 0; background: var(--primary); color: white;">保存して閉じる</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>